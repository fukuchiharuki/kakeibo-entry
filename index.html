<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>家計簿入力</title>

<script src="https://cdn.tailwindcss.com"></script>

<div>
  <header class="my-4">
    <h1 class="text-center text-xl font-bold">家計簿入力</h1>
  </header>

  <!--
  entry.502180998_year: 2024
  entry.502180998_month: 9
  entry.502180998_day: 26
  entry.1644931895: 100
  entry.1263347079: テスト
  entry.1872975358: 特別費
  entry.1354928899: はる
  -->

  <div class="mx-2 my-4">
    <header class="my-1">
      <h2 class="font-bold">使った日:</h2>
    </header>
    <div class="my-1 flex gap-x-1">
      <div class="flex-auto">
        <button class="w-full border border-dashed rounded" id="shortcut-the-day-before-yesterday">一昨日</button>
      </div>
      <div class="flex-auto">
        <button class="w-full border border-dashed rounded" id="shortcut-yesterday">昨日</button>
      </div>
      <div class="flex-auto">
        <button class="w-full border border-dashed rounded" id="shortcut-today">今日</button>
      </div>
    </div>
    <div class="my-1">
      <input class="border rounded px-1" type="text" name="entry.502180998" readonly />
      <span id="day"></span>
    </div>
    <div class="my-1 flex gap-x-1">
      <div class="flex-auto">
        <button class="w-full border rounded" id="manipulate-previous-week">前週</button>
      </div>
      <div class="flex-auto">
        <button class="w-full border rounded" id="manipulate-previous-day">前日</button>
      </div>
      <div class="flex-auto">
        <button class="w-full border rounded" id="manipulate-next-day">翌日</button>
      </div>
      <div class="flex-auto">
        <button class="w-full border rounded" id="manipulate-next-week">翌週</button>
      </div>
    </div>
  </div>
</div>

<script>
  const dateInput = document.querySelector('[name="entry.502180998"]')
  const dayLabel = document.querySelector('#day')

  if (dateInput && !dateInput.value) {
    reflectDate(new Date())
  }

  document.querySelector('#shortcut-today').addEventListener('click', () => {
    reflectDate(new Date())
  })

  document.querySelector('#shortcut-yesterday').addEventListener('click', () => {
    reflectDate(minusDays(new Date(), 1))
  })

  document.querySelector('#shortcut-the-day-before-yesterday').addEventListener('click', () => {
    reflectDate(minusDays(new Date(), 2))
  })

  document.querySelector('#manipulate-previous-week').addEventListener('click', () => {
    reflectDate(minusDays(toDateObject(dateInput.value), 7))
  })

  document.querySelector('#manipulate-previous-day').addEventListener('click', () => {
    reflectDate(minusDays(toDateObject(dateInput.value), 1))
  })

  document.querySelector('#manipulate-next-day').addEventListener('click', () => {
    reflectDate(plusDays(toDateObject(dateInput.value), 1))
  })

  document.querySelector('#manipulate-next-week').addEventListener('click', () => {
    reflectDate(plusDays(toDateObject(dateInput.value), 7))
  })

  

  function reflectDate(date /* :Date */) {
    dateInput.value = toDateString(date)
    dayLabel.innerHTML = `(${["日", "月", "火", "水", "木", "金", "土"][date.getDay()]})`
  }

  function toDateObject(date /* :string */) {
    return new Date(date)
  }
    
  function toDateString(date /* :Date */) {
    return date.toLocaleDateString("ja-JP", { year: "numeric",month: "2-digit", day: "2-digit" })
  }

  function plusDays(date /* :Date */, days /* :number */) {
    const ret = new Date(date)
    ret.setDate(ret.getDate() + days)
    return ret
  }

  function minusDays(date /* :Date */, days /* :number */) {
    return plusDays(date, -days)
  }
</script>
